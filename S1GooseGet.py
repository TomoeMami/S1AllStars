import json
import os
import requests
from bs4 import BeautifulSoup as bs
import re

#返回加鹅扣鹅字典
def get_goosedict(post):
    if len(post.find_all("a",title = "查看全部评分",class_ = "xi2")) ==0:
        return {}
    cookie_str1 = os.getenv('S1_COOKIE')
    cookie_str = repr(cookie_str1)[1:-1]
    # #把cookie字符串处理成字典，以便接下来使用
    cookies = {}
    for line in cookie_str.split(';'):
        key, value = line.split('=', 1)
        cookies[key] = value
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 Edg/87.0.664.47',
        }
    gooselink = "https://bbs.saraba1st.com/2b/"+post.find_all("a",title = "查看全部评分",class_ = "xi2")[0]["href"]
    gooselist = requests.get(gooselink,headers=headers,cookies=cookies)
    gooselist = bs(gooselist.text,"lxml")
    gooselist = gooselist.find_all("div", class_="c floatwrap")[0].find_all("tr")[1:]
    res = {}
    for goose in gooselist:
        attr = goose.find_all('td')
        num = int(attr[0].string[4:-1])
        gooser = attr[1].string
        comment = attr[-1].string
        '''
        if comment is None:
            comment =  ""
        res[gooser] = (num,comment)'''
        res[gooser] = (num)
    return res

#返回一个post的楼层数 int
def get_level(post):
    match = re.search("<em>[0-9]+</em>",str(post))
    if match is None:
        return 1
    else:
        return int(match.group()[4:-5])

#返回一个post的作者名
def get_postername(post):
    return str(post.find_all("div", class_ = "authi")[0].a.string)

#输入一个帖子地址，返回这个帖子，及这个帖子后面所有页面的楼的postlist，可控制筛选
#levels是int list，posters是str list，分别控制楼层数和作者名
def get_allpost(link,levels = None,posters = None):
    res = []
    while True:
        postlist,link = get_postlist(link)
        for post in postlist:
            if levels is not None and get_level(post) not in levels:
                continue
            if posters is not None and get_postername(post) not in posters:
                continue
            res.append(post)
        if link == -1:
            break
    return res

#输入一个帖子地址，返回这个页面所有楼(post)的html节点列表和下一页的link,如果没有下一页的话nxt返回-1
def get_postlist(link):
    cookie_str1 = os.getenv('S1_COOKIE')
    cookie_str = repr(cookie_str1)[1:-1]
    # #把cookie字符串处理成字典，以便接下来使用
    cookies = {}
    for line in cookie_str.split(';'):
        key, value = line.split('=', 1)
        cookies[key] = value
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 Edg/87.0.664.47',
        }
    strhtml = requests.get(link, headers=headers,cookies=cookies)
    soup = bs(strhtml.text, 'lxml')
    nxt = soup.find_all("a", href=True, class_="nxt")
    if len(nxt)!=0:
        nxt = "https://bbs.saraba1st.com/2b/"+nxt[0]["href"]
    else:
        nxt = -1
    try:
        soup = soup.body.find_all("div", id='ct')[0].find_all("div", id="postlist")[0]
        postlist = soup.find_all("div", id=re.compile("post_[0-9]+"))
    except Exception:
        pass
        postlist = []
    return postlist,nxt

if __name__ == '__main__':
    threads = [1330118,1343201,1352401,1476597,1478318,1495480,1530711,1564997,1580156,1722986,1730744,1788231,1798614,1801318,1813626,1816986,1823913,1826698,1843056,1856608,1857369,1858008,1860285,1861134,1907021,1912344,1913532,1913874,1914633,1914770,1915014,1916756,1917415,1918196,1921741,1922041,1924190,1925286,1926401,1933350,1938392,1939252,1939572,1939660,1939713,1940719,1941258,1942220,1946064,1947477,1947535,1947696,1950536,1950960,1953320,1953655,1953696,1953706,1956384,1956605,1957862,1958052,1960458,1960466,1964449,1965593,1971548,1974508,920666,1002001,1052775,1072297,1225930,1232472,1242334,1275523,1321448,1355959,1368000,1375402,1475847,1515235,1539647,1552625,1556697,1566472,1570329,1574255,1592153,1645555,1652344,1711545,1755649,1755653,1789863,1792364,1805691,1810654,1817644,1820599,1824891,1827896,1845667,1850136,1856998,1905029,1922375,1955542,3101458,981916,1851218,1959892,1990766,1910970,1574123,1937785,1967236,1048391,1054815,1074539,1089780,1125982,1155622,1158270,1188139,1274927,1317511,1340164,1356033,1485590,1488095,1494878,1500331,1504388,1505070,1511064,1520197,1527698,1528796,1529658,1539923,1546510,1549210,1551077,1551439,1551549,1551913,1553200,1553679,1558768,1566822,1567536,1568128,1574091,1577140,1577244,1584756,1585936,1586260,1586571,1588795,1589993,1597155,1650840,1706066,1717712,1718713,1722896,1727016,1730719,1732040,1732557,1732613,1741051,1746039,1751268,1754522,1773953,1774471,1776457,1783714,1784292,1785314,1786555,1789334,1789621,1790146,1793674,1794375,1794641,1795723,1797530,1799355,1803647,1804331,1807149,1808621,1811126,1811212,1813674,1814871,1815292,1817148,1817532,1818989,1819120,1822156,1823729,1824599,1825291,1827526,1829147,1831289,1831700,1832337,1839922,1841294,1842807,1843338,1843655,1844155,1844169,1844372,1844424,1844500,1844534,1847633,1854084,1854116,1854204,1856880,1857859,1858391,1858469,1858713,1858841,1859043,1859237,1859334,1860852,1861360,1861406,1864643,1865495,1865763,1867310,1868519,1868556,1869442,1872599,1879438,1886285,1901682,1902688,1904462,1905011,1905601,1905701,1905844,1906697,1906801,1907778,1908551,1909041,1909785,1909927,1909972,1910096,1911112,1912061,1912256,1913416,1914181,1915682,1916007,1916419,1917006,1919004,1919089,1922178,1922788,1923311,1924836,1929198,1930577,1933829,1936385,1938678,1940042,1941234,1941925,1945629,1945708,1945828,1946186,1947613,1950481,1951346,1953420,1953511,1953788,1955213,1957734,1958749,1960103,1965915,645107,853223,866827,870045,882363,934852,985037,1005146,1009008,1010574,1014335,1018501,1025007,1025935,1034361,1045102,1047378,1061969,1062472,1066605,1075666,1080677,1085129,1105845,1105959,1108194,1115780,1136113,1146412,1148153,1148786,1160803,1180903,1204121,1210441,1229445,1243404,1289360,1296766,1301912,1333059,1336413,1336706,1336845,1337602,1342029,1350435,1351199,1356195,1359460,1359462,1365887,1471334,1473080,1477016,1479404,1486439,1499843,1502023,1503154,1505675,1506111,1513038,1521559,1522030,1527697,1528127,1528286,1528813,1529670,1529883,1549678,1550724,1550732,1552818,1553961,1571054,1572029,1572422,1574222,1574553,1577554,1580216,1582708,1586558,1586918,1586924,1588410,1590696,1637573,1645018,1704128,1725754,1729513,1744761,1755583,1770999,1772503,1915375,1785119,1786645,1795203,1797365,1814263,1823023,1829936,1831320,1837674,1844226,1847593,1860270,346283,725340,780726,821720,851614,874190,896785,908099,915143,915948,927657,934526,949824,980228,999173,1974517,1990412,1993692,1994225,1997765,2000928,2003721,2004974,2006218,2007615,2008772,1929955,1949981,1950023,1906409,1909283,1931645,1934528,1938285,1942338,1945207,1945741,1949964,1950425,1956416,1962613,1963398,1969041,1976378,1978671,1985273,1987228,1989348,1991884,1997762,2006072,1966145,1808327,1809379,1829754,1839962,1848341,1856302,1863536,1912063,1929631,1945537,1572644,1749659,1801966,1823171,1857164,1907975,1920426,1924531,1938145,1941579,1962088,1963466,1969498,1944571,1959076,1977780,1980918,1981728,1982602,1982754,1982930,1983143,1983374,1983591,1983832,1984792,1986036,1986601,1986653,1986835,1986859,1986938,1987015,1987107,1987114,1987677,1988181,1989295,1989928,1990607,1991701,1991745,1991877,1991988,1992030,1992123,1993596,1993738,1993970,1994230,1994250,1994705,1995857,1995941,1996086,1996178,1996723,1998459,1998734,1998859,1998943,1999519,1999738,2000825,2000855,2000868,2001311,2003060,2004302,2004541,2005463,2005647,2006312,2006345,2006497,2007020,2008522,2010118,2010286,2010495,2010499,2010511,2010547,2010591,2010919,2011063,2011125,2011275,2011420,2011811,2012358,2012468,2012736,2013277,2013355,2013531,2013814,2014133,2014324,2014354,2015157,1341662,1911848,1915386,1917216,1917307,1917399,1917419,1917595,1918856,1919062,1919255,1920063,1920125,1920213,1922629,1922905,1923066,1923288,1924249,1924514,1929609,1930579,1931507,1933771,1933926,1935091,1935405,1936536,1937427,1937587,1940584,1940592,1940885,1941514,1941515,1941915,1941922,1942396,1942443,1942724,1943287,1943385,1943453,1943459,1943652,1943746,1943987,1944020,1944058,1944161,1944162,1944198,1944380,1944396,1944423,1944528,1944737,1944746,1944750,1944779,1944993,1945056,1945127,1945272,1945311,1945542,1945657,1945742,1945780,1945814,1946093,1951008,1951869,1953108,1954387,1954416,1954453,1955495,1957762,1958784,1959153,1959219,1961102,1962608,1970170,1975703,1975720,1976497,1977611,1977805,1978813,1979266,1979296,1979950,1979981,1914314,1937970,1939204,1940086,1940380,1910469,1911928,1912475,1912584,1912824,1913362,1913718,1914502,1915152,1915816,1916532,1917955,1918099,1919122,1919303,1919856,1920488,1921654,1921823,1922737,1923803,1925105,1930909,1933932,1939205,1942275,1943651,1910782,1911999,1990905,2003424,1806900,1941455,1941806,1942598,1942620,1942676,1942720,1942788,1942789,1942798,1942869,1942870,1942912,1942956,1942964,1942972,1942992,1943002,1943003,1943015,1943055,1943227,1943273,1943388,1943420,1943431,1943498,1943532,1943540,1943617,1943703,1943726,1943743,1943967,1943984,1944028,1944125,1944241,1944530,1944683,1944867,1944868,1944869,1945501,1945502,1945848,1945917,1945926,1945972,1946023,1946090,1947710,1949935,1951362,1951857,1571184,1722999,1574816,1576356,1576627,1577974,1579703,1581261,1582524,1583829,1585473,1586984,1588562,1590350,1594613,1597675,1628823,1636434,1646735,1651982,1673546,1701499,1706960,1712743,1716738,1719892,1722710,1020771,1024891,1026710,1029104,1033769,1044981,1086782,1171904,1172784,1188259,1203712,1206286,1216799,1247271,1250432,1280850,1280921,1311546,1319666,1322745,1324367,1330359,1331216,1331875,1345279,1347154,1347317,1351735,1358001,1358949,1358971,1358984,1359441,1359629,1359806,1384223,1485838,1513739,1515575,1519769,1539614,1558234,1579269,1732781,1769319,1788519,1791857,1803199,1804551,1840052,1852031,1863111,1901346,1910562,1911821,1911976,1911986,1912066,1912339,1912937,1913083,1914172,1914528,1915316,1915398,1915486,1915519,1916048,1916155,1916661,1916866,1917052,1917135,1917229,1917236,1917445,1917667,1918002,1918182,1918779,1918882,1919545,1920813,1922017,1922674,1910597,1943225,1976545,1976657,1976689,1976753,1976803,1976824,1976834,1976847,1977078,1977083,1977099,1977102,1977121,1977155,1977160,1977174,1977195,1977278,1977299,1977315,1977419,1977439,1977444,1977453,1977457,1977463,1977685,1977708,1977777,1977861,1977924,1978094,1978209,1978211,1978293,1978301,1978351,1978409,1978707,1829184,1902510,1916064,1919728,1921423,1924054,1959901,1960399,1963028,1964133,1964421,1964611,1965002,1971370,1973694,1974088,1974844,1974894,1974976,1975229,1975618,1975640,1975658,1976109,1976349,1976985,1977066,1977070,1977274,1977405,1977532,1977544,1977585,1977974,1978080,1978093,1978102,1978163,1978180,1978236,1978280,1978320,1978341,1978513,1978597,1978645,1978657,1978846,1978883,1978886,1978934,1978975,1979150,1979247,1979290,1979304,1979312,1979381,1979532,1979618,1979688,1979755,1979769,1979827,1979949,1980176,1980186,1980192,1980274,1980294,1980326,1980559,1980809,1980891,1981051,1981066,1981119,1981129,1981401,1981519,1981537,1981553,1982184,1982220,1982234,1982315,1982323,1982324,1982336,1982467,1982472,1982513,1982515,1982554,1982600,1982633,1982685,1982696,1982740,1982744,1982746,1982766,1982782,1982813,1982822,1982845,1982851,1983024,1983053,1983062,1983065,1983209,1983381,1983385,1983395,1983407,1983448,1983484,1983512,1983519,1983747,1983883,1983891,1983904,1984006,1984118,1984272,1984379,1984460,1984487,1984511,1984559,1984815,1984859,1985027,1985077,1985195,1985339,1985565,1985566,1985750,1985797,1985809,1985846,1986032,1986316,1986356,1986414,1986582,1986886,1987069,1987409,1987655,1987764,1987815,1987870,1987871,1987898,1988112,1988159,1988397,1988465,1988608,1988640,1988823,1989115,1989170,1989279,1989307,1989309,1989509,1989991,1990019,1990027,1990045,1990092,1990322,1990596,1990762,1990916,1991086,1991097,1991130,1991214,1991231,1991306,1991506,1991511,1991526,1991693,1991779,1991868,1992460,1992468,1992497,1992505,1992576,1992885,1992945,1993217,1993360,1993377,1993494,1993640,1993782,1993862,1994147,1994363,1994499,1994685,1994727,1995356,1995530,1995596,1995740,1996048,1996161,1996758,1997228,1997437,1997478,1997612,1997631,1997794,1998050,1998140,1998204,1998217,1998350,1998462,1998482,1998555,1998616,1998653,1998654,1998791,1998979,1999008,1999036,1999049,1999113,1999198,1999199,1999251,1999316,1999336,1999422,1999589,1999621,1999675,2000064,2000124,2000134,2000186,2000219,2000239,2000244,2000345,2000850,2000899,2000969,2001026,2001106,2001287,2001290,2001478,2001549,2001611,2001998,2002127,2002295,2002400,2002420,2002713,2002814,2002869,2002977,2003098,2003150,2003232,2003442,2003509,2003577,2003594,2003627,2003693,2003928,2003954,2003957,2004035,2004042,2004297,2004330,2004340,2004400,2004414,2004436,2004464,2004475,2004622,2004629,2004773,2004881,2005062,2005302,2005304,2005361,2005421,2005501,2005505,2005518,2005553,2005561,2005719,2005933,2005949,2005970,2006027,2006050,2006064,2006096,2006117,2006128,2006142,2006147,2006216,2006272,2006457,2006525,2006785,2006874,2006898,2006973,2007195,2007328,2007430,2007647,2007779,2007794,2007878,2007889,2007938,2007951,2008093,2008208,2008401,2008502,2008550,2008562,2008694,2008762,2008763,2008836,2008880,2008890,2008956,2008964,2008977,2009091,2009130,2009137,2009252,2009454,2009547,2009558,2009666,2009696,2009759,2009783,2009895,2010206,2010426,2010534,2010592,2010653,2011067,2011109,2011123,2011175,2011265,2011382,2011574,2011632,2011778,2011931,2011940,2012300,2012303,1288559,1289256,1291925,1742440,1784193,1801172,1818837,1822823,1831280,1832530,1855338,1856225,1857555,1858938,1863976,1866150,1872719,1885900,1904187,1904778,1907124,1913543,1913592,1914001,1914902,1915170,1915247,1915385,1915759,1915822,1916221,1916244,1916442,1916494,1916548,1916629,1916640,1916693,1916776,1916806,1917095,1917140,1917233,1918481,1918590,1919128,1919543,1920486,1920746,1921016,1921282,1922507,1922732,1922977,1923359,1924161,1924340,1924402,1924457,1924755,1925170,1925194,1925359,1925432,1929283,1930902,1931651,1932775,1933593,1933840,1933872,1933900,1934457,1935298,1935495,1935709,1936674,1936714,1937067,1938889,1939302,1939666,1939779,1940118,1940194,1940505,1941382,1941415,1941503,1941554,1941714,1941783,1941950,1942408,1942414,1942813,1943079,1943080,1943326,1943702,1943806,1943812,1943840,1944007,1944056,1944067,1944101,1944177,1944365,1944401,1944409,1944455,1944479,1944504,1944563,1944577,1944583,1944758,1944788,1944797,1944873,1944920,1944922,1945289,1945353,1945385,1945585,1945667,1945668,1946268,1946305,1946358,1946462,1946508,1946561,1946659,1946685,1946686,1946698,1946718,1947605,1947655,1947692,1947695,1947789,1947805,1947916,1949913,1949950,1949984,1950587,1950663,1950665,1950683,1950699,1950716,1950837,1950883,1950920,1951004,1951034,1951100,1951417,1951457,1951515,1951771,1951831,1951963,1952061,1952101,1952204,1952215,1952483,1952550,1952552,1952626,1952846,1953386,1953428,1953871,1953973,1954085,1954396,1954413,1954524,1954582,1954883,1954958,1955033,1955297,1955484,1955608,1955641,1955727,1955775,1955893,1955909,1955956,1956138,1956244,1956285,1956696,1956714,1956896,1956970,1957070,1957107,1957460,1957468,1957538,1957556,1957572,1957574,1957636,1957643,1957694,1958077,1958190,1958257,1958271,1958299,1958445,1958527,1958582,1958669,1959006,1959433,1959447,1959521,1959572,1959592,1959613,1959661,1959705,1959857,1959977,1959996,1960068,1960150,1960298,1960307,1960322,1960634,1960706,1960739,1960879,1960993,1961036,1961193,1961375,1961573,1961611,1961709,1961715,1961739,1961746,1961783,1961790,1961857,1961923,1961946,1961967,1961989,1962073,1962105,1962110,1962225,1962501,1962833,1962886,1962896,1963041,1963065,1963373,1963479,1963649,1963797,1963804,1963933,1963934,1963977,1964010,1964709,1965430,1965613,1965933,1966142,1966214,1966231,1967005,1967023,1967063,1967274,1967363,1969345,1969474,1969629,1969802,1970115,1970123,1970783,1970801,1970893,1970973,1971325,1971346,1971528,1971580,1971878,1972032,1972345,1972582,1972795,1973409,1973425,1973475,1973486,1973511,1973563,1973698,1974090,1974187,270746,1753169,1785863,1833120,1839821,1858571,1903393,1931589,1969675,1972153,1973904,1974170,1974353,1974817,1974932,1975194,1975216,1976026,1977583,1977587,1977614,1977823,1978443,1978668,1978810,1978833,1979014,1979025,1979199,1979497,1979576,1979605,1979657,1979839,1980269,1980607,1980709,1980761,1980781,1980919,1981106,1981161,1981174,1981196,1981380,1981430,1981473,1981497,1981616,1981650,1981691,1981777,1981901,1982031,1982064,1982376,1982582,1982775,1983044,1983189,1983309,1983427,1983960,1984144,1984189,1984584,1984621,1984761,1984897,1985060,1985083,1985648,1985688,1986144,1986402,1986580,1986767,1986912,1987414,1987494,1987521,1987847,1988097,1988196,1988473,1988705,1989354,1989364,1989871,1989898,1990129,1990286,1990652,1990703,1991643,1991999,1992760,1993369,1993569,1993988,1994097,1994654,1995228,1995262,1995343,1995784,1995919,1996099,1996759,1997176,1997561,1998069,1998116,1998591,1999906,1999911,2000032,2000049,2000704,2000764,2000775,2000817,2001043,2001245,2001904,2002561,2002796,2003084,2003287,2003608,2004071,2004075,2004694,2004697,2004777,2004808,2004813,2004869,2004895,2004906,2005061,2005142,2005309,2005499,2006051,2006292,2006546,2006739,2006792,2006977,2007274,2007518,2008287,2008396,2008527,2008990,2009723,2009823,2009864,2009871,2010029,2010575,2010596,2011202,2011227,2011332,2011577,2011590,2011738,2011913,2012232,1812672,1836225,1849127,1860591,1861953,1862152,1863513,1911451,1911601,1911963,1912026,1913839,1915318,1915924,1916451,1917164,1917657,1917896,1918056,1918554,1921963,1922740,1922968,1923944,1925638,1928759,1930038,1931742,1934084,1934973,1936873,1938906,1939703,1940130,1940611,1941111,1941850,1942265,1943699,1943876,1944393,1944548,1944726,1945065,1945167,1945237,1945764,1946079,1946388,1946542,1946551,1947620,1947721,1947767,1948099,1950608,1950674,1951182,1951769,1952067,1952073,1952221,1952365,1953408,1953866,1954022,1954248,1954317,1954327,1954452,1954881,1955113,1955137,1955276,1955595,1955602,1956181,1956477,1957314,1957326,1957662,1957777,1958179,1958210,1958421,1958470,1958516,1958571,1958575,1958813,1958819,1958821,1958832,1959300,1959490,1959823,1960119,1960282,1960967,1961048,1961099,1961995,1962432,1962516,1962671,1962723,1962727,1962742,1962846,1964220,1964798,1965724,1965833,1966335,1966575,1966704,1966778,1966875,1967122,1967250,1967343,1967431,1967693,1967762,1969280,1969340,1969455,1970339,1970538,1971039,1971459,1971655,1971741,1971919,1971974,1972480,1973572,1973592,1974093,1974388,709087,956833,1595632,1860016,1098311,1855294,1923951,1931717,1946215,1964815,1972129,1972742,1973111,1973829,1974547,1974809,1974864,1975152,1975188,1975297,1975345,1975363,1975371,1975379,1975405,1975451,1975498,1975567,1975639,1975680,1975704,1975708,1975844,1976115,1976171,1976201,1976234,1976399,1976401,1976436,1976474,1976502,1976508,1976529,1976534,1976683,1976726,1976806,1976859,1976867,1976883,1976919,1976925,1976952,1977025,1977057,1977162,1977221,1977428,1977482,1977483,1977509,1977550,1977556,1977608,1977661,1977751,1977817,1977850,1978046,1978117,1978138,1978531,1978669,1978759,1978902,1978904,1978932,1978965,1979055,1979146,1979177,1979195,1979208,1979299,1979402,1979476,1979573,1979582,1979596,1979651,1979709,1979784,1979891,1980002,1980061,1980094,1980096,1980118,1980204,1980212,1980214,1980278,1980321,1980335,1980365,1980441,1980467,1980531,1980852,1980873,1980876,1981035,1981058,1981080,1981130,1981339,1981360,1981365,1981431,1981440,1981448,1981479,1981480,1981481,1981543,1981629,1981679,1981810,1981912,1981970,1981999,1982020,1982026,1982200,1982241,1982244,1982271,1982279,1982335,1982375,1982446,1982449,1982507,1982564,1982585,1982605,1982722,1982730,1982755,1982807,1982838,1982891,1982894,1982905,1982998,1983072,1983089,1983255,1983287,1983330,1983416,1983443,1983459,1983470,1983569,1983637,1983768,1983780,1983839,1983965,1983996,1984000,1984015,1984088,1984139,1984160,1984228,1984299,1984354,1984429,1984532,1984569,1984596,1984601,1984602,1984633,1984722,1984756,1984784,1984905,1984917,1984937,1984946,1984994,1985107,1985112,1985246,1985248,1985250,1985266,1985272,1985281,1985397,1985412,1985485,1985495,1985543,1985593,1985615,1985663,1985692,1985792,1985844,1985883,1985895,1985901,1985908,1985931,1985945,1986105,1986111,1986179,1986208,1986220,1986355,1986403,1986412,1986431,1986469,1986561,1986583,1986644,1986692,1986707,1986737,1987088,1987132,1987166,1987193,1987215,1987286,1987371,1987504,1987651,1987704,1987756,1987786,1987921,1987925,1988017,1988061,1988153,1988169,1988200,1988205,1988211,1988261,1988460,1988484,1988542,1988575,1988668,1988695,1988792,1988894,1988942,1988961,1989034,1989044,1989114,1989156,1989186,1989220,1989311,1989328,1989413,1989503,1989555,1989558,1989714,1989769,1989850,1989861,1989932,1990097,1990253,1990278,1990312,1990326,1990368,1990675,1990815,1990894,1990996,1991021,1991053,1991092,1991141,1991209,1991301,1991375,1991498,1991570,1991806,1991833,1991880,1991945,1992146,1992212,1992235,1992284,1992387,1992440,1992731,1992748,1992832,1992931,1992958,1993017,1993030,1993245,1993292,1993325,1993339,1993447,1993472,1993499,1993522,1993566,1993575,1993590,1993629,1993735,1993747,1993762,1993818,1993877,1993907,1993917,1993983,1994098,1994140,1994273,1994291,1994490,1994548,1994695,1994804,1995122,1995239,1995280,1995550,1995577,1995591,1995664,1995674,1995686,1995698,1995728,1995776,1995816,1995834,1995863,1996033,1996042,1996066,1996121,1996168,1996883,1996969,1997321,1997350,1997392,1997396,1997418,1997428,1997481,1997542,1997575,1997639,1997717,1997740,1997757,1997842,1997881,1997913,1997945,1997947,1998058,1998070,1998071,1998172,1998210,1998215,1998261,1998346,1998422,1998433,1998439,1998450,1998471,1998528,1998619,1998661,1998707,1998713,1998768,1998810,1998811,1998874,1999060,1999070,1999101,1999102,1999159,1999174,1999269,1999421,1999443,1999522,1999546,1999619,1999660,1999763,1999773,1999817,1999834,1999859,1999888,1999894,2000094,2000098,2000164,2000222,2000318,2000347,2000351,2000382,2000432,2000433,2000434,2000442,2000520,2000533,2000552,2000631,2000716,2000776,2000832,2000851,2000862,2000887,2000920,2000971,2001011,2001085,2001088,2001108,2001211,2001268,2001293,2001398,2001431,2001433,2001484,2001508,2001601,2001628,2001632,2001655,2001707,2001728,2001834,2001840,2001864,2001961,2001974,2002019,2002043,2002048,2002070,2002142,2002197,2002205,2002272,2002367,2002516,2002559,2002560,2002571,2002602,2002642,2002670,2002709,2002745,2002842,2002880,2002904,2002943,2002971,2002983,2003013,2003016,2003049,2003201,2003300,2003331,2003352,2003356,2003386,2003416,2003438,2003450,2003461,2003487,2003596,2003599,2003630,2003638,2003668,2003737,2003743,2003772,2003776,2003781,2003910,2003933,2003976,2004013,2004038,2004055,2004150,2004191,2004224,2004285,2004294,2004295,2004350,2004356,2004373,2004431,2004497,2004526,2004598,2004660,2004671,2004713,2004715,2004729,2004738,2004878,2004889,2004910,2004959,2005023,2005056,2005072,2005092,2005100,2005106,2005135,2005155,2005173,2005228,2005411,2005418,2005428,2005449,2005472,2005517,2005551,2005578,2005655,2005841,2005845,2005893,2005968,2006001,2006011,2006087,2006121,2006124,2006131,2006166,2006212,2006382,2006433,2006505,2006604,2006631,2006719,2006817,2006826,2006871,2006979,2007015,2007259,2007473,2007478,2007494,2007525,2007668,2007683,2007693,2007695,2007729,2007811,2007840,2007986,2007996,2007998,2008014,2008059,2008064,2008095,2008137,2008262,2008276,2008348,2008566,2008633,2008634,2008658,2008703,2008706,2008713,2008724,2008736,2008776,2008784,2008804,2008814,2008842,2008844,2008850,2008886,2008892,2008954,2008992,2009041,2009142,2009190,2009241,2009248,2009265,2009301,2009505,2009563,2009572,2009597,2009620,2009625,2009638,2009717,2009720,2009794,2009920,2009922,2010072,2010090,2010129,2010210,2010370,2010372,2010404,2010438,2010443,2010451,2010522,2010525,2010533,2010614,2010635,2010709,2010804,2010845,2010853,2010862,2010900,2011082,2011157,2011235,2011243,2011256,2011264,2011284,2011302,2011343,2011366,2011375,2011414,2011449,2011459,2011468,2011508,2011513,2011554,2011562,2011656,2011685,2011747,2011759,2011807,2011851,2011873,2011890,2011917,2011957,2012016,2012161,2012177,2012327,2012389,2012415,2012437,2012450,2012461,1984360,1094814,1284417,1533747,1845999,1906893,1908544,1914620,1915332,1915536,1915885,1915925,1916096,1916792,1917189,1917408,1918318,1918703,1919072,1919525,1919706,1920318,1920761,1920975,1921134,1921484,1921878,1921929,1922029,1922774,1922779,1922873,1922896,1923342,1923581,1924037,1924413,1924617,1924711,1924728,1924841,1924893,1925055,1925065,1925108,1925342,1925403,1925429,1925531,1925639,1926093,1928659,1929924,1930485,1930873,1930892,1931498,1931829,1932059,1932218,1932273,1932570,1932593,1932643,1932776,1932820,1932898,1933086,1933097,1933137,1933166,1933170,1933233,1933289,1933432,1933448,1933450,1933456,1933522,1933598,1933677,1933713,1933752,1933757,1933793,1933876,1934341,1934703,1934774,1935450,1935710,1935896,1935897,1936059,1936214,1936384,1936611,1936750,1936762,1936830,1936832,1936863,1937477,1937510,1937689,1937738,1938634,1938936,1938967,1938976,1938979,1939138,1939304,1939376,1939681,1939714,1939825,1939954,1940096,1940133,1940154,1940166,1940222,1940238,1940330,1940376,1940459,1940461,1940492,1940522,1940709,1940765,1940815,1940834,1940844,1940860,1941023,1941063,1941281,1941440,1941456,1941478,1941491,1941541,1941634,1941981,1942139,1942260,1942278,1942637,1942767,1942781,1943039,1943330,1943353,1943377,1943423,1943434,1943542,1943578,1943641,1943882,1943989,1944120,1944122,1944359]
    # 设置请求头
    for threadid in threads:
        link = "https://bbs.saraba1st.com/2b/thread-"+str(threadid)+"-1-1.html"
        posts = get_allpost(link=link)
        print("get post finish")
        res=[]
        for post in posts:
            level = get_level(post)
            poster = get_postername(post)
            gooselist = get_goosedict(post)
            if(gooselist):
                data={}
                data['level'] = level
                data['id'] = poster
                data['goose'] = gooselist
                res.append(data)
        if(posts):
            with open('./data/'+str(2015387)+'.json',"w",encoding='utf-8') as f:
                    f.write(json.dumps(res,indent=2,ensure_ascii=False))
        with open('./breakpoint.txt',"w",encoding='utf-8') as f:
                f.write(threadid)